(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const c of n)if(c.type==="childList")for(const f of c.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&a(f)}).observe(document,{childList:!0,subtree:!0});function r(n){const c={};return n.integrity&&(c.integrity=n.integrity),n.referrerPolicy&&(c.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?c.credentials="include":n.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function a(n){if(n.ep)return;n.ep=!0;const c=r(n);fetch(n.href,c)}})();const g={tablePlayerPlaceholder:document.getElementById("table-player-placeholder"),tableOpponentPlaceholder:document.getElementById("table-opponent-placeholder"),btnRandomize:document.getElementById("btn-randomize"),btnReset:document.getElementById("btn-reset"),btnRotate:document.getElementById("btn-rotate"),log:document.getElementById("log")},v=(()=>{const u=(t=[],o=!1)=>{let s=document.createElement("tbody");const l=document.createElement("table");return l.appendChild(s),t.forEach((h,m)=>{let A=document.createElement("tr");h.forEach((S,I)=>A.innerHTML+=`<td class="${S.isHit?S.occupant?S.occupant.isSunk()?"sunk":"hit":"mis":""} ${o&&S.occupant?"ship":""}" data-x="${I}" data-y="${m}"></td>`),s.appendChild(A)}),l},e=t=>{t.textContent=""},r=(t,o)=>{e(o),o.appendChild(t)},a=t=>{const o=u(t,!0);r(o,g.tablePlayerPlaceholder)},n=t=>{const o=u(t);r(o,g.tableOpponentPlaceholder)},c=()=>{document.querySelectorAll("td.ship").forEach(o=>{const s=Number(o.dataset.x),l=Number(o.dataset.y);o.classList.add("reserved");for(let h=-1,m=1;h<=1;h++,m--){const A=g.tablePlayerPlaceholder.querySelector(`[data-y="${l}"][data-x="${s+h}"]`),S=g.tablePlayerPlaceholder.querySelector(`[data-y="${l+h}"][data-x="${s}"]`),I=g.tablePlayerPlaceholder.querySelector(`[data-y="${l+h}"][data-x="${s+h}"]`),z=g.tablePlayerPlaceholder.querySelector(`[data-y="${l+m}"][data-x="${s+h}"]`);A&&A.classList.add("reserved"),S&&S.classList.add("reserved"),I&&I.classList.add("reserved"),z&&z.classList.add("reserved")}})},f=()=>{document.querySelectorAll("td.reserved").forEach(t=>t.classList.remove("reserved"))},p=()=>{document.querySelectorAll("td.highlight").forEach(t=>t.classList.remove("highlight"))},y=()=>{document.querySelector(":root").style.setProperty("--clr-highlight","red")},k=()=>{document.querySelector(":root").style.removeProperty("--clr-highlight")},L=(t,o,s,l)=>{p();const h=(m,A)=>{const S=document.querySelector(`[data-x="${A}"][data-y="${m}"]`);S?(S.classList.add("highlight"),k()):y()};if(l==="h")for(let m=0;m<s;m++)h(t,o+m);if(l==="v")for(let m=0;m<s;m++)h(t+m,o)},E=(t,o,s,l)=>{L(t,o,s,l),c()},$=()=>{p(),f()};let P;function b(t,o=0){P&&clearTimeout(P),O();function s(){o<t.length&&(g.log.textContent+=t.charAt(o),o++,P=setTimeout(s,50))}s()}const O=()=>{e(g.log)};function T(){O(),b("Start attacking your opponent ðŸŽ¯")}return{updateOpponentTable:n,updatePlayerTable:a,logStart:T,logGameOver:(t="")=>{b(`Congrats ðŸŽ‰. ${t?t.name+" is the winner.":""} click restart button to play again...`)},highlightPlaces:E,removeHighlights:$,logPlace:t=>{b(`There are ${t} ships ðŸš¢ remind. hover on your board to place them.`)},logAttackResult:t=>{if(t.occupant){if(t.occupant.isSunk()){b("Great job. an enemy ship has been sunk â˜ ï¸");return}b("You hit a ship tile, keep attacking it ðŸŒŠ");return}b("missed shot")}}})(),N=u=>{const e=[];return{len:u,hits:e,hit:n=>{e.includes(n)||n>u||n<0||e.push(n)},isSunk:()=>e.length===u}},B=()=>{const e=[5,4,3,3,2];let r=0,a="h",n=Array.from({length:10},i=>Array.from({length:10},t=>({occupant:null,isHit:!1,shipIndex:0})));const c=(i,t,o,s)=>{for(let l=0;l<o;l++)if(s==="v"&&n[i+l][t].occupant||s==="h"&&n[i][t+l].occupant)return!0;return!1},f=(i,t,o,s)=>{if(s==="v"){if(t<0||t>=10||i<0||i+o>10)return!1;for(let l=-1;l<o+1;l++)if(i+l>=0&&i+l<10&&(c(i+l,t,1,"v")||t+1<10&&c(i+l,t+1,1,"v")||t-1>=0&&c(i+l,t-1,1,"v")))return!1}else if(s==="h"){if(t<0||t+o>10||i<0||i>=10)return!1;for(let l=-1;l<o+1;l++)if(t+l>=0&&t+l<10&&(c(i,t+l,1,"h")||i+1<10&&c(i+1,t+l,1,"h")||i-1>=0&&c(i-1,t+l,1,"h")))return!1}return!0},p=(i,t,o,s)=>{if(!f(i,t,o,s))return!1;const l=N(o);if(s==="v")for(let h=0;h<o;h++)n[i+h][t].occupant=l,n[i+h][t].shipIndex=h;else if(s==="h")for(let h=0;h<o;h++)n[i][t+h].occupant=l,n[i][t+h].shipIndex=h;return!0},y=(i,t)=>{const o=n[i][t];return o.isHit===!0?!1:(o.occupant&&o.occupant.hit(o.shipIndex),o.isHit=!0,!0)},k=()=>{a==="h"?a="v":a="h"},L=()=>{e.forEach((i,t)=>{for(;;){const o=["h","v"],s=Math.floor(Math.random()*10),l=Math.floor(Math.random()*10);if(p(l,s,i,o[t%2]))break}})},E=()=>{for(let i=0;i<n.length;i++)for(let t=0;t<n[i].length;t++)if(n[i][t].occupant&&!n[i][t].occupant.isSunk())return!1;return!0},$=()=>{n.forEach((i,t)=>{i.forEach((o,s)=>{n[t][s].occupant=null,n[t][s].isHit=!1,n[t][s].shipIndex=0})})},P=()=>{for(let i=0;i<n.length;i++)for(let t=0;t<n[0].length;t++)if(n[i][t].isHit)return!0;return!1},b=(i,t)=>{r>=T&&(r=0),p(i,t,e[r],a)&&r++},O=()=>{let i=0;for(let t=0;t<n.length;t++)for(let o=0;o<n[0].length;o++)n[t][o].occupant&&n[t][o].shipIndex===0&&i++;return i},T=()=>e.length;return{placeShip:p,board:n,receiveAttack:y,placeShipsRandomly:L,areAllShipsSunk:E,hasReceivedAttack:P,resetBoard:$,toggleDirection:k,placeNextShip:b,isFull:()=>O()===T(),remindShipsCount:()=>e.length-O(),nextShipLength:()=>e[r],nextShipDirection:()=>a}};class x{constructor(e,r){this.name=e,this.gameboard=r,this.shooted=new Set}randomPosition(e=10){return[Math.floor(Math.random()*e),Math.floor(Math.random()*e)]}isAlreadyHit([e,r]){return this.shooted.has(`${e}-${r}`)}randomTarget(e){let r=this.randomPosition(e.length);for(;this.isAlreadyHit(r);)r=this.randomPosition(e.length);return r}attack(e,r){return this.gameboard.receiveAttack(e,r)}randomAttack(){if(this.shooted.size===this.gameboard.board.length*this.gameboard.board.length)return;const e=this.randomTarget(this.gameboard.board);this.gameboard.receiveAttack(...e),this.shooted.add(`${e[0]}-${e[1]}`)}}class H extends x{constructor(e,r){super(e,r),this.ships=[],this.hitStack=[],this.directions=[[0,1],[1,0],[0,-1],[-1,0]],this.directionsIndex=0}toggleDirectionsIndex(e=1){for(this.directionsIndex+=e;this.directionsIndex>=this.directions.length;)this.directionsIndex-=this.directions.length}shootTarget(e,r){const a=this.gameboard.board[e][r];return this.shooted.add(`${e}-${r}`),a.occupant&&!a.isHit&&this.hitStack.push([e,r]),this.gameboard.receiveAttack(e,r)}reservedSet(){return this.shooted}attack(){return this.hitStack.length?this.attackNearby(this.hitStack[this.hitStack.length-1]):this.smartRandomAttack()}isValidCoordinates(e,r){const a=this.gameboard.board.length;return r!==null&&e!==null&&r>=0&&r<a&&e>=0&&e<a}neighbors(e=this.hitStack[this.hitStack.length-1]){return this.directions.map(r=>[e[0]+r[0],e[1]+r[1]])}possibleShipPlace(e,r){const a=this.reservedSet().has(`${e}-${r}`);return console.log(`y: ${e}, x: ${r}`),console.log(a),this.isValidCoordinates(e,r)&&!a}attackNearby(){if(!this.hitStack.length){this.smartRandomAttack();return}const e=this.hitStack[this.hitStack.length-1],r=this.neighbors(e);let[a,n]=r[this.directionsIndex],c=4;for(;!this.possibleShipPlace(a,n)&&c--;)this.toggleDirectionsIndex(),[a,n]=r[this.directionsIndex];if(!this.possibleShipPlace(a,n)){this.smartRandomAttack();return}const f=this.gameboard.board[a][n],p=this.shootTarget(a,n),[y,k]=this.neighbors([a,n])[this.directionsIndex];return f.occupant&&f.occupant.isSunk()&&(this.hitStack=[]),(this.hitStack.length>=2&&!f.occupant||this.hitStack.length>=2&&!this.possibleShipPlace(y,k))&&(this.toggleDirectionsIndex(2),this.hitStack.reverse()),!f.occupant&&this.hitStack.length==1&&this.toggleDirectionsIndex(),p}smartRandomAttack(){let[e,r]=this.randomPosition();for(;!this.possibleShipPlace(e,r);)[e,r]=this.randomPosition();return this.shootTarget(e,r)}}const d=(()=>{let u,e,r,a;const n=()=>{r=B(),a=B(),u=new x("you",a),e=new H("opponent",r)},c=()=>p()&&(r.areAllShipsSunk()||a.areAllShipsSunk()),f=()=>r.areAllShipsSunk()?e:a.areAllShipsSunk()?u:null,p=()=>r.hasReceivedAttack()||a.hasReceivedAttack();return{init:n,isOver:c,winner:f,isStarted:p,isReadyToStart:()=>r.isFull()&&a.isFull()&&!p(),getPlayerBoard:()=>r.board,getOpponentBoard:()=>a.board,getPlayerGameboard:()=>r,getOpponentGameboard:()=>a,player:()=>u,opponent:()=>e}})();function G(){let u,e,r,a,n,c;function f(){u=d.getOpponentGameboard(),e=d.getPlayerGameboard(),r=d.getPlayerBoard(),a=d.getOpponentBoard(),c=d.player(),n=d.opponent()}function p(){v.updatePlayerTable(r)}function y(){v.updateOpponentTable(a)}function k(){y(),p()}function L(i){if(d.isOver()||!d.isReadyToStart()&&!d.isStarted())return;const t=i.target;if(t.localName!=="td")return;const o=Number(t.dataset.x),s=Number(t.dataset.y);c.attack(s,o)&&(E(),$(),k(),R(a[s][o]))}function E(){if(d.isOver()){y(),R();return}}function $(){n.attack(),d.isOver()&&(p(),v.logGameOver(d.winner()))}function P(){d.init(),f(),u.placeShipsRandomly(),k(),R()}function b(){d.isStarted()||(e.resetBoard(),e.placeShipsRandomly(),p(),R())}function O(i){if(e.isFull())return;const t=i.target,o=Number(t.dataset.x),s=Number(t.dataset.y);v.highlightPlaces(s,o,e.nextShipLength(),e.nextShipDirection())}function T(i){if(e.isFull())return;const t=i.target,o=Number(t.dataset.x),s=Number(t.dataset.y);e.placeNextShip(s,o),p(),R()}function R(i=null){d.isReadyToStart()||v.logPlace(e.remindShipsCount()),d.isReadyToStart()&&v.logStart(),d.isStarted()&&i&&v.logAttackResult(i),d.isOver()&&v.logGameOver(d.winner())}function C(){e.toggleDirection()}document.addEventListener("DOMContentLoaded",P),g.tableOpponentPlaceholder.addEventListener("click",L),g.btnReset.addEventListener("click",P),g.btnRandomize.addEventListener("click",b),g.tablePlayerPlaceholder.addEventListener("mouseover",O),g.tablePlayerPlaceholder.addEventListener("mouseleave",v.removeHighlights),g.tablePlayerPlaceholder.addEventListener("click",T),g.btnRotate.addEventListener("click",C)}G();
